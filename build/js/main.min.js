let restaurants,neighborhoods,cuisines;var newMap,markers=[];function favouriteRestaurant(id){let fav_icon=document.getElementById(`fav_icon_btn-${id}`).childNodes,fav_icon_class=fav_icon[0].className,toast_msg=document.getElementById("toast-msg");"far fa-star"==fav_icon_class?fetch(`http://localhost:1337/restaurants/${id}/?is_favorite=true`,{method:"PUT",headers:{"Content-Type":"application/json"}}).then(res=>res.json()).then(function(){fav_icon[0].className="fas fa-star",toast_msg.innerHTML="Added to favourite Restaurants!",toast_msg.className="show",setTimeout(function(){toast_msg.className=toast_msg.className.replace("show","")},2e3)}).catch(error=>console.error("Error:",error)):fetch(`http://localhost:1337/restaurants/${id}/?is_favorite=false`,{method:"PUT",headers:{"Content-Type":"application/json"}}).then(res=>res.json()).then(function(){fav_icon[0].className="far fa-star",toast_msg.innerHTML="Removed from favourite Restaurants!",toast_msg.className="show",setTimeout(function(){toast_msg.className=toast_msg.className.replace("show","")},2e3)}).catch(error=>console.error("Error:",error))}document.addEventListener("DOMContentLoaded",event=>{initMap(),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((error,neighborhoods)=>{error?console.error(error):(self.neighborhoods=neighborhoods,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((neighborhoods=self.neighborhoods)=>{const select=document.getElementById("neighborhoods-select");neighborhoods.forEach(neighborhood=>{const option=document.createElement("option");option.innerHTML=neighborhood,option.value=neighborhood,select.append(option)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((error,cuisines)=>{error?console.error(error):(self.cuisines=cuisines,fillCuisinesHTML())})}),fillCuisinesHTML=((cuisines=self.cuisines)=>{const select=document.getElementById("cuisines-select");cuisines.forEach(cuisine=>{const option=document.createElement("option");option.innerHTML=cuisine,option.value=cuisine,select.append(option)})}),initMap=(()=>{self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoic2NvcnBpb25rIiwiYSI6ImNqaXNleXA0ZzBsOWozdnJyYXMzZHFyZ3kifQ.IEY-dNY3duQlpoQi3HvC6A",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()}),updateRestaurants=(()=>{const cSelect=document.getElementById("cuisines-select"),nSelect=document.getElementById("neighborhoods-select"),cIndex=cSelect.selectedIndex,nIndex=nSelect.selectedIndex,cuisine=cSelect[cIndex].value,neighborhood=nSelect[nIndex].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood,(error,restaurants)=>{error?console.error(error):(resetRestaurants(restaurants),fillRestaurantsHTML())})}),resetRestaurants=(restaurants=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(marker=>marker.remove()),self.markers=[],self.restaurants=restaurants}),fillRestaurantsHTML=((restaurants=self.restaurants)=>{const ul=document.getElementById("restaurants-list");restaurants.forEach(restaurant=>{ul.append(createRestaurantHTML(restaurant))}),addMarkersToMap()}),createRestaurantHTML=(restaurant=>{const li=document.createElement("li"),image=document.createElement("img");image.className="restaurant-img",image.src=DBHelper.imageUrlForRestaurant(restaurant),image.alt=`Image of ${restaurant.name}`,li.append(image);const name=document.createElement("h2");name.innerHTML=restaurant.name,li.append(name);const neighborhood=document.createElement("p");neighborhood.innerHTML=restaurant.neighborhood,li.append(neighborhood);const address=document.createElement("p");address.innerHTML=restaurant.address,li.append(address);const more=document.createElement("a");more.innerHTML="View Details",more.href=DBHelper.urlForRestaurant(restaurant),li.append(more);const br=document.createElement("br");li.append(br);const fav_icon=document.createElement("i");"false"==restaurant.is_favorite?fav_icon.className="far fa-star":fav_icon.className="fas fa-star";const fav_icon_btn=document.createElement("button");return fav_icon_btn.id=`fav_icon_btn-${restaurant.id}`,fav_icon_btn.className="fav_icon_btn",fav_icon_btn.setAttribute("aria-label","Button to mrak restaurant as favourite"),fav_icon_btn.addEventListener("click",function(){favouriteRestaurant(restaurant.id)}),fav_icon_btn.append(fav_icon),li.append(fav_icon_btn),li}),addMarkersToMap=((restaurants=self.restaurants)=>{restaurants.forEach(restaurant=>{const marker=DBHelper.mapMarkerForRestaurant(restaurant,self.newMap);marker.on("click",function(){window.location.href=marker.options.url}),self.markers.push(marker)})});